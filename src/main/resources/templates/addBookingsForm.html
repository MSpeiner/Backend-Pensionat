<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Bookings</title>
</head>
<style>
    td {
        text-align: center;
        width: 200px;
        background-color: lightgrey;
    }
    th {
        background-color: black;
        color: whitesmoke;
        width: 200px;
    }
    select {
        width: 175px;
    }
</style>
<body>
<div class="header">
    <h1>Pensionat Koriander !</h1>
    <a th:href="@{/customers}">Customer</a>
    <a th:href="@{/bookings}">Booking</a>
    <a th:href="@{/rooms}">Room</a>
</div>
<div><h3>Add Bookings</h3></div>
<table>
    <tr>
        <th>Customer:</th>
        <th>From:</th>
        <th>To:</th>
        <th>Room Type:</th>
        <th>Extra beds:</th>
        <th>Room Number:</th>
        <th>Add</th>
    </tr>

    <tr>
        <td>
            <label>
                <select name="customerInfo" id="customerBox">
                    <option th:value="${bookingSearch != null? bookingSearch.customer.id: ''}"
                            th:text="${bookingSearch != null ? bookingSearch.customer.id + ': ' + bookingSearch.customer.firstName + ' ' + bookingSearch.customer.lastName : 'Choose customer'}" value="">
                    </option>
                    <option th:each="customer : ${customersList}"
                            th:value="${customer.id}"
                            th:text="${customer.id + ': ' + customer.firstName + ' ' + customer.lastName}">
                    </option>
                </select>
            </label>
        </td>
        <td>
            <label for="startDate">
                <input type="date" name="startDate" id="startDate" th:value="${bookingSearch != null ? bookingSearch.startDate: ''}" onchange="updateEndDateOnChange()" required>
            </label>
        </td>
        <td>
            <label for="endDate">
                <input type="date" name="endDate" th:value="${bookingSearch != null ? bookingSearch.endDate: ''}" id="endDate" required>
            </label>
        </td>
        <td>
            <label>
                <select id="roomTypeBox" onchange="searchRooms()">
                    <option th:text="${bookingSearch != null ? bookingSearch.roomType : 'Choose room type'}" value="">
                    </option>
                    <option th:each="type: ${roomTypeList}"
                            th:value="${type}"
                            th:text="${type}">
                    </option>
                </select>
            </label>
        </td>
        <td>
            <label>
                <select id="extraBedsBox" name="amountOfBeds" >
                    <option>Choose extra bed</option>
                </select>
            </label>
        </td>
        <td>
            <label>
                <select id="roomNumberBox">
                    <option>Room Number</option>
                    <option th:each="room: ${roomsList}"
                            th:value="${room.getId()}"
                            th:text="${room.getRoomNumber()}">
                    </option>
                </select>
            </label>
        </td>
        <td>
            <button onclick="addBooking()">Add</button>
        </td>
    </tr>
</table>

<script>
    function updateEndDateOnChange() {
        const startDate = new Date(document.getElementById('startDate').value)
        startDate.setDate(startDate.getDate() + 1)

        const minDate = startDate.toISOString().split("T")[0]
        const endDate = document.getElementById('endDate');
        endDate.setAttribute('min', minDate)
        endDate.value = minDate;
    }

    function searchRooms() {
        const customerID = document.getElementById('customerBox').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const roomType = document.getElementById('roomTypeBox').value;

        window.location.href = "/bookings/add/" + customerID + "/" + startDate + "/" + endDate + "/" + roomType;
    }

    function addBooking() {
        const customerID = document.getElementById('customerBox').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const extraBeds = document.getElementById('extraBedsBox').value;
        const roomNo = document.getElementById('roomNumberBox').value;
        console.log(roomNo);

        window.location.href = "/bookings/add/" + customerID + "/" + startDate + "/" + endDate + "/" + extraBeds + "/" + roomNo
    }

    function updateExtraBeds() {
        const roomType = document.getElementById('roomTypeBox').options[0].textContent
        const extraBedsBox = document.getElementById('extraBedsBox')
        console.log(roomType)

        let max = 0;

        switch (roomType) {
            case "DOUBLE":
                max = 1;
                break;
            case "SUITE":
                max = 2;
                break;
            default:
                max = 0;
        }

        // extraBedsBox.disabled = roomType === 1;

        document.querySelectorAll('.appendedOption').forEach(option => extraBedsBox.removeChild(option))

        for(let i = 0; i <= max; i++) {
            const option = document.createElement("option")
            option.className = 'appendedOption'
            option.innerText = i.toString()

            extraBedsBox.appendChild(option)
        }
    }

    document.addEventListener("DOMContentLoaded", updateExtraBeds);
</script>
</body>
</html>